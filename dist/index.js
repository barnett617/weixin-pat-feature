function renderChatContentTitle(e){document.getElementById("chat-content-title").innerText=e}function genOtherMsg(e){const t=document.createElement("div");t.setAttribute("class","msg-wrap-other");const n=document.createElement("img");n.setAttribute("src",e.avatar),n.setAttribute("data-username",e.username),n.setAttribute("data-tapmsg",e.tapMsg),n.setAttribute("class","avatar-common"),t.appendChild(n);const a=document.createElement("div");a.setAttribute("class","msg-other-right");const s=document.createElement("div");if(s.innerText=e.username,s.setAttribute("class","msg-username"),a.appendChild(s),"img"===e.type){const t=document.createElement("img");t.setAttribute("src",e.content),a.appendChild(t)}else if("text"===e.type){const e=document.createElement("div");e.setAttribute("class","msg-other"),a.appendChild(e)}return t.appendChild(a),t}function genSelfMsg(e){const t=document.createElement("div");if(t.setAttribute("class","msg-wrap-self"),"img"===e.type){const n=document.createElement("img");n.setAttribute("src",e.content),t.appendChild(n)}else if("text"===e.type){const n=document.createElement("span");n.innerText=e.content,t.appendChild(n)}const n=document.createElement("img");return n.setAttribute("src",e.avatar),n.setAttribute("data-username",e.username),n.setAttribute("data-tapmsg",e.tapMsg),n.setAttribute("class","avatar-common"),t.appendChild(n),t}function genUserMsgDomByType(e){let t;return t=e.username===currentUser?genSelfMsg(e):genOtherMsg(e)}function genTimeMsgDom(e){const t=document.createElement("div");return t.innerText=e.content,t.setAttribute("class","msg-system-timestamp"),t}function genTapMsgDom(e){const t=document.createElement("div");return t.innerText=e.content,t.setAttribute("class","msg-system-tap"),t}function renderChatContent(e){const t=e.map(e=>{let t;return t="timestamp"===e.type?genTimeMsgDom(e):genUserMsgDomByType(e)}),n=document.getElementById("chat-content");t.forEach(e=>{n.appendChild(e)})}function bindAvatarEvent(){document.querySelectorAll(".avatar-common").forEach(e=>{e.addEventListener("click",handleAvatarClickWrapper)})}function handleAvatarClickWrapper(e){if(window.doubleTap){if(!window.lock)return window.lock=!0,setTimeout(()=>{window.lock=!1},1e4),handleAvatarClick.call(this,e);{const e=window.confirm("撤回刚才这次拍一拍?");console.log("answer",e),e&&(window.lock=!1,clearLastTap())}}else window.doubleTap=!0,setTimeout(()=>{window.doubleTap=!1},500)}function clearLastTap(){const e=document.getElementById("chat-content"),t=document.querySelectorAll(".msg-system-tap");e.removeChild(t[t.length-1])}function handleAvatarClick(e){const{username:t,tapmsg:n}=e.target.dataset;let a="";a=t===currentUser?"我拍了拍自己":`我拍了拍"${t}"`,n&&(a+=`说${n}`),addNewSystemMsg(a)}function addNewSystemMsg(e){const t=document.getElementById("chat-content"),n=genTapMsgDom({username:"system",type:"tap",content:e});t.appendChild(n)}function setup(){window.currentUser="wilson",renderChatContentTitle("鑫仔亲友团(7)");renderChatContent([{avatar:"https://user-images.githubusercontent.com/23159565/127432393-8171b70d-cc4a-4454-adab-1dcb010f4f52.jpeg",username:"卷卷星",type:"img",content:"https://user-images.githubusercontent.com/23159565/127431269-a33af7aa-974f-4ab8-8dc4-4d7fc3a50eab.png",tapMsg:"来钓鱼🎣"},{username:"system",type:"timestamp",content:"11:05"},{avatar:"https://user-images.githubusercontent.com/23159565/127432445-57fa5223-9002-4dc1-b557-1ec2710f65ee.jpeg",username:"wilson",type:"text",content:"开始做拍一拍",tapMsg:""}]),bindAvatarEvent()}setup();